#Daniel Eisterhold
#dte130030@utdallas.edu
#CS 3376.502
# PROJECTNAME is a descriptive name used for the backup target
# This should not contain spaces or special characters
PROJECTNAME = Program_4

#Settings for gcc
CXX = gcc
CFLAGS = -Wall -c

#Settings for flex
LEX = flex
LFLAGS = 

#Settings for bison
YACC = bison
YFLAGS = -dy

#Name of Executable
EXECNAME = program4
#List of Objects need to create executable
OBJS = parse.o scan.o main.o

all: $(EXECNAME)
	make link

$(EXECNAME): $(OBJS)
	$(CXX) -o $@ $(OBJS)

scan.o: scan.c parse.h
	$(CXX) $(CFLAGS) scan.c -o scan.o

scan.c: scan.l
	$(LEX) $(LFLAGS) -o scan.c scan.l

parse.o: parse.c
	$(CXX) $(CFLAGS) -o parse.o parse.c

parse.c: parse.y
	$(YACC) $(YFLAGS) parse.y -o parse.c

parse.h: parse.y
	$(YACC) $(YFLAGS) parse.y -o parse.c

main.o: main.c
	$(CXX) $(CFLAGS) main.c -o main.o

link:
	@ln -fs $(EXECNAME) scanner
	@ln -fs $(EXECNAME) parser

clean:
	@rm -f $(OBJS) *.P *~ \#* scanner parser scan.c parse.c parse.h lex.yy.c

clean-all: clean
	@rm -f $(EXECNAME)

tar:
	tar -cvf $(EXECNAME).tar.gz *

backup:
	@mkdir -p ~/backups; chmod 700 ~/backups
	@$(eval CURDIRNAME := $(shell basename `pwd`))
	@$(eval MKBKUPNAME := ~/backups/$(PROJECTNAME)-$(shell date +'%Y.%m.%d-%H:%M:%S').tar.gz)
	@echo
	@echo Writing Backup file to: $(MKBKUPNAME)
	@echo
	@-tar zcfv $(MKBKUPNAME) ../$(CURDIRNAME)
	@chmod 600 $(MKBKUPNAME)
	@echo
	@echo Done!

# Keep C file generated by flex
#.PRECIOUS: scan.c
